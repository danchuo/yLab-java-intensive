# Wallet-Service


*Wallet-Service* - это веб-сервис для управления кредитными и дебетовыми транзакциями от имени игроков с использованием HTTP запросов.

**Проект выполнен в рамках интенсива по Java от YLab.**

## История проекта

### Этап 1: Начало (Консольное приложение)

Проект был создан как консольное приложение для управления кредитными и дебетовыми транзакциями от имени игроков с использованием языка Java и базовых коллекций данных. На данном этапе были реализованы следующие функции: регистрация и авторизация игроков, управление балансом игроков, дебетовые и кредитные транзакции, а также аудит действий игроков.

### Этап 2: Внедрение PostgreSQL и Liquibase (База данных)

В рамках второго этапа развития проекта была внедрена база данных PostgreSQL для более надежного и устойчивого хранения данных. Идентификаторы сущностей стали выдаваться через sequence, и были созданы DDL-скрипты на создание таблиц и скрипты на предзаполнение таблиц с использованием инструмента миграции Liquibase. Нотация XML была выбрана для написания скриптов миграции. Служебные таблицы были размещены в отдельной схеме, и таблицы сущностей больше не хранились в схеме public.

### Этап 3: Переход к Servlets (Сервлеты)

На третьем этапе был осуществлен переход от консольного приложения к веб-приложению с использованием сервлетов для обработки HTTP запросов и отправки JSON данных. Интерфейс стал более удобным и доступным для пользователей. Кроме того, были добавлены Data Transfer Objects (DTO) и маппинг сущностей в DTO с использованием MapStruct. Валидация входящих DTO также была внедрена для обеспечения корректности данных.

### Этап 4: Внедрение Spring и AspectJ (Spring)

Четвёртый этап проекта представлял собой внедрение фреймворка Spring и аспектов для более удобной разработки и управления зависимостями. Был переход от сервлетов к Spring MVC для обработки HTTP запросов и создания REST-контроллеров. Также был добавлен Swagger для документирования API. Аспекты были переписаны на Spring AOP, и внедрение зависимостей происходило только через конструктор.

### Этап 5: Внедрение Spring Boot (Spring Boot)

На последнем этапе проект был полностью переведен на Spring Boot версии 3.2.0 с использованием необходимых стартеров. Все кастомные конфигурационные файлы были заменены на application.yml. Сервлеты и аспекты аудита и логирования были вынесены в отдельные стартеры и сделаны отдельными модулями. Проект полностью управлялся Spring Boot, и добавлен Swagger UI с использованием SpringDoc.

Эти изменения позволили улучшить архитектуру проекта, сделать его более надежным, масштабируемым и удобным в разработке.

### Версии заданий

Вы можете найти версии каждого задания в ветках проекта на GitHub.


*Wallet-Service* - веб-сервис для управления кредитными и дебетовыми транзакциями от имени игроков с использованием HTTP запросов.

## Инструкции по использованию

Для сборки приложения выполните команду

`mvn clean compile aspectj:compile package -Dmaven.test.skip`

Далее, сначала запустите контейнер с базой данных, выполнив команду docker-compose up, а затем запустите приложение.

## Доступ к Swagger UI

Можно получить доступ к документации API проекта, используя Swagger UI. Запустите проект и перейдите по
следующему адресу в вашем веб-браузере:
[http://localhost:8086/swagger-ui/index.html](http://localhost:8086/swagger-ui/index.html)

## Основные функции

Приложение предоставляет следующие основные функции:

- **Регистрация игрока**: Вы можете зарегистрировать нового игрока, отправив JSON с данными о логине и пароле на эндпоинт.

- **Авторизация игрока**: После регистрации вы можете авторизоваться, отправив JSON с логином и паролем на соответствующий эндпоинт. После успешной авторизации вы получите JWT.

- **Просмотр текущего баланса игрока**: После авторизации вы можете узнать текущий баланс своего аккаунта, отправив JWT на соответствующий эндпоинт.

- **Дебет/Снятие средств**: Вы можете совершать дебетовые транзакции для снятия средств со счета игрока, отправляя соответствующий JSON на эндпоинт. Дебетовая транзакция будет успешной только в том случае, если на счету достаточно средств. Также, каждая транзакция должна иметь уникальный идентификатор.

- **Кредит**: Вы можете совершать кредитные транзакции для пополнения счета игрока, отправляя JSON на соответствующий эндпоинт. Как и в случае с дебетовыми транзакциями, каждая кредитная транзакция должна иметь уникальный идентификатор.

- **Просмотр истории транзакций**: После авторизации вы можете просматривать историю пополнения и снятия средств со счета игрока, отправив JWT на соответствующий эндпоинт.

- **Маппинг сущностей**: Для маппинга сущностей в DTO используется MapStruct.

- **Валидация входящих ДТО**: Для обеспечения корректности входящих данных ваши ДТО подвергаются валидации.

- **JWT авторизация**: Метод логина выдает JWT, который используется для авторизации при выполнении других методов.

## Для сборки приложения выполните команду

`mvn clean compile aspectj:compile package -Dmaven.test.skip`

Далее, сначала запустите контейнер с базой данных, выполнив команду docker-compose up, а затем запустите приложение.

## Доступ к Swagger UI

Можно получить доступ к документации API проекта, используя Swagger UI. Запустите проект и перейдите по
следующему адресу в вашем веб-браузере:
[http://localhost:8086/swagger-ui/index.html](http://localhost:8086/swagger-ui/index.html)

---
© 2023 danchuo
